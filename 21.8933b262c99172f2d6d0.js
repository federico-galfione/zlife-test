(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{"1omm":function(e,t,n){"use strict";n.r(t),n.d(t,"MessaggiModule",(function(){return fe}));var r=n("Valr"),c=n("sPEm"),o=n("w1ql"),a=n("6onV"),i=n("TYT/"),s=(n("CYVr"),n("iLY4")),g=n("Axka"),u=n("mrSG");n("bne5"),n("Gi3i"),n("IZi1");var b=function(){function e(){}return e.\u0275mod=i.Tb({type:e}),e.\u0275inj=i.Sb({factory:function(t){return new(t||e)},imports:[[s.c,r.c,g.h]]}),e}(),f=n("ey9i"),l=n("PCNd"),p=n("DUip"),m=n("67Y/"),h=Object(a.n)("[Contatti Page] Contatti Success Receiving",Object(f.s)()),d=Object(a.n)("[Contatti Page] Contatti Request"),O=Object(a.n)("[Chat Page] Messaggi Success Receiving",Object(f.s)()),P=Object(a.n)("[Chat Page] Richiesta Messaggi",Object(f.s)()),v=Object(a.n)("[Chat Page] Nuovo messaggio ricevuto",Object(f.s)()),C=Object(a.n)("[Contatti Page] La pagina \xe8 stata cambiata, carica nuovi contatti",Object(f.s)()),j=Object(a.n)("[Chat Page] Send Message",Object(f.s)()),M=Object(a.n)("[Chat Page] Set remote user",Object(f.s)()),x=Object(a.n)("[Chat Page] Typed Message",Object(f.s)()),y=Object(a.o)(f.l),_=Object(a.q)(y,(function(e){return e.contattiPage.contatti})),U=Object(a.q)(y,(function(e){return e.contattiPage.currentPage})),I=Object(a.q)(y,(function(e){return e.chatPage.currentChat.messages})),z=Object(a.q)(y,(function(e){return e.chatPage.currentChat.remoteUser})),w=(Object(a.q)(y,(function(e){return e.chatPage.currentChat.typing})),n("6blF")),k=n("/PH2"),S=n("AytR"),T=n("cUzu"),J=n("Kp+N"),R=function(){function e(e,t,n,r){var c=this;this.http=e,this.socket=t,this.store=n,this.router=r,this.baseUrl=S.a.server.url,this.myUser={id:100,firstName:"Mario",lastName:"Rossi",image:"assets/icon/placeholder_face.png",role:"Paziente",unreadMsg:!1},this.socket.fromEvent("user/NewMessage").pipe(Object(k.a)(this.store.select((function(e){return e.remoteSession.isInitiator})))).subscribe((function(e){var t=Object(u.g)(e,2);t[1]&&c.store.dispatch(v({message:t[0],dispatchToRemote:!0,clearTyping:!1}))}))}return e.prototype.getContattiList=function(){return this.http.get(this.baseUrl+"/contacts")},e.prototype.getMessaggiList=function(e){return this.http.get(this.baseUrl+"/messages/"+e)},e.prototype.navigateToChat=function(e){this.store.dispatch(M({user:e,dispatchToRemote:!0})),this.router.navigate(["messaggi","chat",e.id])},e.prototype.receiveMessages=function(){var e=this;return this.store.select(I).pipe(Object(k.a)(this.store.select(z)),Object(m.a)((function(t){var n=Object(u.g)(t,2),r=n[1];return n[0].map((function(t){return{text:t.message,author:0===t.side?r:e.myUser,timestamp:new Date(t.creationTime)}}))})))},e.prototype.sendMessage=function(e,t){var n=this;return new w.a((function(r){n.socket.emit("user/SendMessage",{userId:e,message:t},(function(e){})),r.next(t)}))},e.\u0275fac=function(t){return new(t||e)(i.gc(T.b),i.gc(J.a),i.gc(a.h),i.gc(p.j))},e.\u0275prov=i.Rb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),$=n("vqQA"),N=n("dkbr"),W=n("/733"),V=n("byPC"),q=n("CgzN"),D=n("sSbh");function F(e,t){if(1&e){var n=i.cc();i.Zb(0),i.bc(1,"zlife-user-card",7),i.kc("onClick",(function(){i.Ec(n);var e=t.$implicit;return i.nc().navigateToChat(e)})),i.bc(2,"zlife-ngrx-button",8),i.kc("onClick",(function(){i.Ec(n);var e=t.$implicit;return i.nc().navigateToChat(e)})),i.ac(),i.ac(),i.Yb()}if(2&e){var r=t.$implicit;i.Jb(1),i.tc("user",r),i.Jb(1),i.Nb("highlight",r.unreadMsg),i.tc("text",r.unreadMsg?"Nuovo messaggio":"Scrivi")("elementId","btn"+r.id)}}var L=function(){function e(e,t,n){this.store=e,this.router=t,this.messaggiService=n,this.messaggiFeatureKey=f.l,this.store.dispatch(d()),this.contatti$=this.store.select(_).pipe(Object(m.a)((function(e){var t=[];return e.forEach((function(e){e.unreadMsg?t.unshift(e):t.push(e)})),t}))),this.currentPage$=this.store.select(U)}return e.prototype.pageChanged=function(e){this.store.dispatch(C({currentPage:e,dispatchToRemote:!0}))},e.prototype.navigateToChat=function(e){this.messaggiService.navigateToChat(e)},e.\u0275fac=function(t){return new(t||e)(i.Vb(a.h),i.Vb(p.j),i.Vb(R))},e.\u0275cmp=i.Pb({type:e,selectors:[["app-contatti-page"]],features:[i.Ib([{provide:f.f,useFactory:f.f.create([f.l,"contattiPage"])}])],decls:12,vars:4,consts:[["title","Contatti"],[1,"container"],[1,"title"],["name","messaggi"],[1,"content"],["scrollName","contactsList",3,"elementsInPage","elements","pageChange"],[4,"zlifeListItem"],[3,"user","onClick"],["icon","white-messaggi","iconPosition","left",3,"text","elementId","onClick"]],template:function(e,t){1&e&&(i.bc(0,"ion-header"),i.Wb(1,"zlife-status-bar",0),i.ac(),i.bc(2,"ion-content"),i.bc(3,"div",1),i.bc(4,"div",2),i.Wb(5,"zlife-icon",3),i.bc(6,"span"),i.Oc(7,"Invia un messaggio"),i.ac(),i.ac(),i.bc(8,"div",4),i.bc(9,"zlife-list-scroller-tracker",5),i.kc("pageChange",(function(e){return t.pageChanged(e)})),i.oc(10,"async"),i.Mc(11,F,3,5,"ng-container",6),i.ac(),i.ac(),i.ac(),i.ac()),2&e&&(i.Jb(9),i.tc("elementsInPage",3)("elements",i.pc(10,2,t.contatti$)))},directives:[c.j,$.a,c.f,N.i,W.a,V.a,q.a,D.a],pipes:[r.b],styles:["zlife-list-scroller-tracker[_ngcontent-%COMP%]{--items-margin-top:16px;--page-margin:8px}.container[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{display:flex;align-items:center;padding:16px}.container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{margin-left:16px;font-size:var(--font-size-9)}.container[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{flex:1;min-height:0}.container[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   zlife-ngrx-button[_ngcontent-%COMP%]{--font-weight:800;--font-color:#fff;--border:4px solid var(--ion-color-secondary);--background-color:var(--ion-color-secondary);--icon-height:32px;--background-color-hover:var(--ion-color-secondary-tint);--font-color-hover:var(--ion-color-secondary-contrast);--border-hover:4px solid var(--ion-color-secondary)}.container[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   zlife-ngrx-button.highlight[_ngcontent-%COMP%]{--border:4px solid var(--ion-color-primary);--background-color:var(--ion-color-primary);--background-color-hover:var(--ion-color-primary-tint);--font-color-hover:var(--ion-color-primary-contrast);--border-hover:4px solid var(--ion-color-primary)}"]}),e}(),Y=n("t9fZ"),Z=n("t4Ze"),E=n("H/jU");function A(e,t){1&e&&i.Wb(0,"zlife-icon",7)}function G(e,t){1&e&&i.Wb(0,"img",8)}function H(e,t){if(1&e&&i.Wb(0,"img",9),2&e){var n=i.nc(2);i.tc("src",n.remoteUser.image,i.Gc)}}function K(e,t){if(1&e&&(i.Zb(0),i.bc(1,"div",3),i.Mc(2,A,1,0,"zlife-icon",4),i.Mc(3,G,1,0,"img",5),i.Mc(4,H,1,1,"img",6),i.ac(),i.Yb()),2&e){var n=i.nc();i.Jb(2),i.tc("ngIf",n.remoteUser.isDottore),i.Jb(1),i.tc("ngIf",!n.remoteUser.image),i.Jb(1),i.tc("ngIf",n.remoteUser.image)}}function Q(e,t){1&e&&i.Wb(0,"zlife-icon",7)}function B(e,t){1&e&&i.Wb(0,"img",8)}function X(e,t){if(1&e&&i.Wb(0,"img",9),2&e){var n=i.nc(2);i.tc("src",n.currentUser.image,i.Gc)}}function ee(e,t){if(1&e&&(i.Zb(0),i.bc(1,"div",10),i.Mc(2,Q,1,0,"zlife-icon",4),i.Mc(3,B,1,0,"img",5),i.Mc(4,X,1,1,"img",6),i.ac(),i.Yb()),2&e){var n=i.nc();i.Jb(2),i.tc("ngIf",n.currentUser.isDottore),i.Jb(1),i.tc("ngIf",!n.currentUser.image),i.Jb(1),i.tc("ngIf",n.currentUser.image)}}var te=function(e,t){return{left:e,right:t,"message-container":!0}},ne=function(){function e(){}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=i.Pb({type:e,selectors:[["zlife-message"]],inputs:{message:"message",currentUser:"currentUser",remoteUser:"remoteUser"},decls:6,vars:7,consts:[[3,"ngClass"],[4,"ngIf"],[1,"message"],[1,"image-container"],["name","dottore",4,"ngIf"],["src","/assets/placeholders/user-placeholder.svg",4,"ngIf"],[3,"src",4,"ngIf"],["name","dottore"],["src","/assets/placeholders/user-placeholder.svg"],[3,"src"],[1,"image-container","&&","currentUser"]],template:function(e,t){1&e&&(i.bc(0,"div",0),i.Mc(1,K,5,3,"ng-container",1),i.bc(2,"div",2),i.bc(3,"div"),i.Oc(4),i.ac(),i.ac(),i.Mc(5,ee,5,3,"ng-container",1),i.ac()),2&e&&(i.tc("ngClass",i.xc(4,te,!t.message.side,!!t.message.side)),i.Jb(1),i.tc("ngIf",!t.message.side&&t.remoteUser),i.Jb(3),i.Pc(t.message.message),i.Jb(1),i.tc("ngIf",!!t.message.side))},directives:[r.k,r.m,N.i],styles:['[_nghost-%COMP%]{--image-height:92px;margin:16px 0}.left[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{margin-top:calc(8px + var(--image-height)/2);padding:16px;margin-left:50px;margin-right:64px;background-color:#fff;border:4px solid var(--ion-color-medium);border-radius:4px;position:relative}.left[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]:before{border-left:20px solid transparent;border-right:20px solid var(--ion-color-medium);border-top:20px solid var(--ion-color-medium);border-bottom:20px solid transparent;border-radius:0 4px 4px 0;left:-40px;top:-4px}.left[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]:after, .left[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]:before{content:"";width:0;height:0;position:absolute}.left[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]:after{border-color:#fff #fff transparent transparent;border-style:solid;border-width:16px;left:-31px;top:0}.right[_ngcontent-%COMP%]{justify-content:flex-end}.right[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{margin-top:calc(8px + var(--image-height)/2);padding:16px;margin-right:50px;margin-left:64px;background-color:#fff;border:4px solid var(--ion-color-medium);border-radius:4px;position:relative}.right[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]:before{border-left:20px solid var(--ion-color-medium);border-right:20px solid transparent;border-top:20px solid var(--ion-color-medium);border-bottom:20px solid transparent;border-radius:0 4px 4px 0;right:-40px;top:-4px}.right[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]:after, .right[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]:before{content:"";width:0;height:0;position:absolute}.right[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]:after{border-color:#fff transparent transparent #fff;border-style:solid;border-width:16px;right:-31px;top:0}.message-container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row}.message-container[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:var(--image-height);margin:8px;border-radius:4px}.message-container[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]   zlife-icon[_ngcontent-%COMP%]{--height:32px;position:absolute}']}),e}();function re(e,t){if(1&e&&i.Wb(0,"zlife-user-card-summary",8),2&e){var n=i.nc();i.tc("name",n.remoteUser.firstName+" "+n.remoteUser.lastName)("prefix",n.remoteUser.isDottore?"Dott.":"")("role",n.remoteUser.role)}}function ce(e,t){if(1&e&&(i.Zb(0),i.Wb(1,"zlife-message",9),i.Yb()),2&e){var n=t.$implicit,r=i.nc();i.Jb(1),i.tc("message",n)("currentUser",r.localUser)("remoteUser",r.remoteUser)}}var oe=[{path:"",component:L},{path:"chat/:remoteUserId",component:function(){function e(e,t,n){var r=this;this.router=e,this.store=t,this.messaggiService=n,this.localUser={firstName:"Mario",id:23124,image:"./assets/placeholders/anziano.jpg",lastName:"Rossi",role:"Utente",isDottore:!1},this.scrollElement=null,this.remoteUserId=this.router.snapshot.params.remoteUserId,this.store.select(z).pipe(Object(Y.a)(1)).subscribe((function(e){return r.remoteUser=e})),this.store.select((function(e){return e.remoteSession})).pipe(Object(Y.a)(1),Object(f.n)(this.store)).subscribe((function(e){r.store.dispatch(P({userId:e.userId,dispatchToRemote:!1}))})),this.messaggi$=n.receiveMessages(),this.zlifeMessages$=this.store.select(I)}return e.prototype.sendMessage=function(e){this.store.dispatch(j({remoteUserId:this.remoteUserId,message:e.message.text,dispatchToRemote:!0}))},e.prototype.ngAfterViewInit=function(){},e.\u0275fac=function(t){return new(t||e)(i.Vb(p.a),i.Vb(a.h),i.Vb(R))},e.\u0275cmp=i.Pb({type:e,selectors:[["app-chat-page"]],features:[i.Ib([{provide:f.f,useFactory:f.f.create([f.l,"chatPage"])}])],decls:12,vars:4,consts:[["title","Chat"],[1,"second-toolbar"],[1,"toolbar-content"],["name","messaggi"],[3,"name","prefix","role",4,"ngIf"],["padding",""],["scrollName","chatPageScroll",1,"list-scroller"],[4,"ngFor","ngForOf"],[3,"name","prefix","role"],[3,"message","currentUser","remoteUser"]],template:function(e,t){1&e&&(i.bc(0,"ion-header"),i.Wb(1,"zlife-status-bar",0),i.bc(2,"ion-toolbar",1),i.bc(3,"div",2),i.Wb(4,"zlife-icon",3),i.Mc(5,re,1,3,"zlife-user-card-summary",4),i.ac(),i.ac(),i.ac(),i.bc(6,"ion-content",5),i.bc(7,"zlife-list-scroller",6),i.Mc(8,ce,2,3,"ng-container",7),i.oc(9,"async"),i.ac(),i.ac(),i.bc(10,"ion-footer"),i.Wb(11,"ion-toolbar"),i.ac()),2&e&&(i.Jb(5),i.tc("ngIf",t.remoteUser),i.Jb(3),i.tc("ngForOf",i.pc(9,2,t.zlifeMessages$)))},directives:[c.j,$.a,c.p,N.i,r.m,c.f,Z.a,r.l,c.i,E.a,ne],pipes:[r.b],styles:["ion-content[_ngcontent-%COMP%]{--padding-top:0;--padding-bottom:0}.list-scroller[_ngcontent-%COMP%]{height:100%}.second-toolbar[_ngcontent-%COMP%]{--background:#fff;padding:16px 0;box-shadow:0 5px 5px 0 rgba(0,0,0,.16)}.second-toolbar[_ngcontent-%COMP%]   .toolbar-content[_ngcontent-%COMP%]{display:flex;align-items:center}.second-toolbar[_ngcontent-%COMP%]   .toolbar-content[_ngcontent-%COMP%]   zlife-icon[_ngcontent-%COMP%]{margin:0 16px 0 32px}"]}),e}()}],ae=function(){function e(){}return e.\u0275mod=i.Tb({type:e}),e.\u0275inj=i.Sb({factory:function(t){return new(t||e)},imports:[[p.l.forChild(oe)],p.l]}),e}(),ie=n("15JJ"),se=n("VnD/"),ge=function(){function e(e,t,n){var r=this;this.actions$=e,this.messaggiService=t,this.store=n,this.contattiReceived$=Object(o.c)((function(){return r.actions$.pipe(Object(o.d)(d),Object(ie.a)((function(e){return r.messaggiService.getContattiList()})),Object(m.a)((function(e){return h({contatti:e,dispatchToRemote:!0})})))})),this.messaggiReceived$=Object(o.c)((function(){return r.actions$.pipe(Object(o.d)(P),Object(ie.a)((function(e){return r.messaggiService.getMessaggiList(e.userId)})),Object(m.a)((function(e){return O({messages:e,dispatchToRemote:!0})})))})),this.sendMessage$=Object(o.c)((function(){return r.actions$.pipe(Object(o.d)(j),Object(k.a)(r.store.select((function(e){return e.remoteSession.isInitiator}))),Object(se.a)((function(e){return Object(u.g)(e,2)[1]})),Object(ie.a)((function(e){var t=Object(u.g)(e,1)[0];return r.messaggiService.sendMessage(t.remoteUserId,t.message)})),Object(m.a)((function(e){return v({dispatchToRemote:!0,message:{creationTime:(new Date).toISOString(),id:1e3*Math.random(),message:e,side:1},clearTyping:!0})})))}))}return e.\u0275fac=function(t){return new(t||e)(i.gc(o.a),i.gc(R),i.gc(a.h))},e.\u0275prov=i.Rb({token:e,factory:e.\u0275fac}),e}(),ue=Object(a.p)({contattiPage:{contatti:[],currentPage:1},chatPage:{currentChat:{messages:[],remoteUser:null,typing:""}}},Object(a.r)(h,(function(e,t){return Object(u.a)(Object(u.a)({},e),{contattiPage:Object(u.a)(Object(u.a)({},e.contattiPage),{contatti:t.contatti})})})),Object(a.r)(O,(function(e,t){return Object(u.a)(Object(u.a)({},e),{chatPage:Object(u.a)(Object(u.a)({},e.chatPage),{currentChat:Object(u.a)(Object(u.a)({},e.chatPage.currentChat),{messages:t.messages})})})})),Object(a.r)(v,(function(e,t){return Object(u.a)(Object(u.a)({},e),{chatPage:Object(u.a)(Object(u.a)({},e.chatPage),{currentChat:Object(u.a)(Object(u.a)({},e.chatPage.currentChat),{messages:Object(u.h)(e.chatPage.currentChat.messages,[t.message]),typing:t.clearTyping?"":e.chatPage.currentChat.typing})})})})),Object(a.r)(C,(function(e,t){return Object(u.a)(Object(u.a)({},e),{contattiPage:Object(u.a)(Object(u.a)({},e.contattiPage),{currentPage:t.currentPage})})})),Object(a.r)(M,(function(e,t){return Object(u.a)(Object(u.a)({},e),{chatPage:Object(u.a)(Object(u.a)({},e.chatPage),{currentChat:Object(u.a)(Object(u.a)({},e.chatPage.currentChat),{remoteUser:t.user})})})})),Object(a.r)(x,(function(e,t){return Object(u.a)(Object(u.a)({},e),{chatPage:Object(u.a)(Object(u.a)({},e.chatPage),{currentChat:Object(u.a)(Object(u.a)({},e.chatPage.currentChat),{typing:t.message})})})})));function be(e,t){return ue(e,t)}var fe=function(){function e(){}return e.\u0275mod=i.Tb({type:e}),e.\u0275inj=i.Sb({factory:function(t){return new(t||e)},providers:[],imports:[[r.c,c.q,f.b,l.a,ae,a.j.forFeature(f.l,be),o.b.forFeature([ge]),b]]}),e}()}}]);