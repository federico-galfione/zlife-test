(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"4NTb":function(t,e,n){"use strict";n.r(e),n.d(e,"MisurazioneModule",(function(){return kt}));var i=n("Valr"),r=n("QJY3"),o=n("sPEm"),a=n("w1ql"),s=n("6onV"),c=n("iLY4"),u=n("PcmI"),l=n("ey9i"),h=(n("yLV6"),n("PCNd")),p=n("dkbr"),f=n("DUip"),d=n("mrSG"),v=n("xMyE"),b=n("t9fZ");function g(t){switch(t){case"Uguale":return"eq";case"Diverso":return"ne";case"Maggiore":return"gt";case"Minore":return"lt";case"Maggiore o uguale":return"ge";case"Minore o uguale":return"le"}}var m=function(){function t(){}return t.buildCriteria=function(t){var e,n,i,r,o,a=[];try{for(var s=Object(d.j)(t),c=s.next();!c.done;c=s.next()){var u=c.value,l=("\n        "+u.fhirField+(null!==(i=u.modifier)&&void 0!==i?i:"")+"="+(null!==(r=g(u.operator))&&void 0!==r?r:"")+(null!==(o=u.system)&&void 0!==o?o:"")+"|"+u.value+"\n      ").trim();a.push(l)}}catch(h){e={error:h}}finally{try{c&&!c.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return a},t.buildCriteriaForDatePeriod=function(t,e,n,i){var r=function(t){return(null==i?void 0:i.dropTime)?t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate():t.toISOString()};return[t+"=ge"+r(e),t+"=le"+r(n)]},t.createObservation=function(t){var e={code:"vital-signs",system:"http://terminology.hl7.org/CodeSystem/observation-category"},n={code:{code:e},category:{code:e}};return Object(d.a)(Object(d.a)({},n),t)},t.getMappingByCode=function(t){for(var e in y)if(y[e].fhirCode===t)return{key:e,observation:y[e]};return null},t}(),y={pressioneMax:{fhirCode:"8480-6",fhirSystem:"http://loinc.org",display:"P.Max",icon:"pressione",fhirUnit:"mm[Hg]",displayUnit:"mmHg",minValue:40,maxValue:250},pressioneMin:{fhirCode:"8462-4",fhirSystem:"http://loinc.org",display:"P.Min",icon:"pressione",fhirUnit:"mm[Hg]",displayUnit:"mmHg",minValue:40,maxValue:250},frequenzaCardiaca:{fhirCode:"8867-4",fhirSystem:"http://loinc.org",display:"Frequenza",icon:"frequenza",fhirUnit:"bpm",displayUnit:"bpm",minValue:35,maxValue:250},temperaturaCorporea:{fhirCode:"8310-5",fhirSystem:"http://loinc.org",display:"Temperatura",icon:"temperatura",fhirUnit:"Cel",displayUnit:"\xb0C",minValue:30,maxValue:45},peso:{fhirCode:"29463-7",fhirSystem:"http://loinc.org",display:"Peso",icon:"bilancia",fhirUnit:"kg",displayUnit:"kg",minValue:30,maxValue:200}},O=Object(s.n)("[Add Observation] Aggiungi nuova osservazione",Object(l.s)()),M=Object(s.n)("[Add Observation] Aggiunta nuova osservazione con successo",Object(l.s)()),j=Object(s.n)("[Add Observation] Aggiunta nuova osservazione errore",Object(l.s)()),T=function(t){return t.misurazione},x=Object(s.q)(T,(function(t){return t.misurazionePage.observations})),D=Object(s.q)(T,(function(t){return t.misurazionePage.intervals})),C=Object(s.q)(T,(function(t){return t.misurazionePage.selectedInterval})),P=Object(s.q)(T,(function(t){return t.misurazionePage.isLoading})),I=Object(s.q)(T,(function(t){return t.misurazionePage.error})),z=Object(s.q)(T,(function(t){return t.misurazionePage.requestedObservations})),E=Object(s.q)(T,(function(t){return t.misurazionePage.startDate})),S=Object(s.q)(T,(function(t){return t.misurazionePage.endDate})),w=Object(s.q)(T,(function(t){return t.misurazionePage.currentObservationUrl})),k=Object(s.q)(T,(function(t){return t.aggiungiMisurazionePage.isLoading})),_=Object(s.q)(T,(function(t){return t.aggiungiMisurazionePage.error})),F=n("TYT/"),R=n("vqQA"),A=n("sGPI"),$=n("sSbh"),q=n("pKW8");function L(t,e){if(1&t&&(F.bc(0,"div"),F.Oc(1," Si \xe8 verificato un problema. "),F.bc(2,"pre"),F.Oc(3),F.oc(4,"json"),F.oc(5,"async"),F.ac(),F.ac()),2&t){var n=F.nc();F.Jb(3),F.Pc(F.pc(4,1,F.pc(5,3,n.hasError$)))}}function U(t,e){1&t&&F.Wb(0,"ion-progress-bar",4)}function J(t,e){if(1&t&&(F.bc(0,"div",6),F.bc(1,"label"),F.Oc(2),F.ac(),F.bc(3,"div"),F.Wb(4,"zlife-ngrx-textbox",10),F.bc(5,"span",11),F.Oc(6),F.ac(),F.ac(),F.ac()),2&t){var n=e.$implicit,i=F.nc(2);F.Jb(2),F.Pc(n.display),F.Jb(2),F.tc("elementId",n.fhirCode)("formControl",i.addObservationForm.controls[n.fhirCode]),F.Jb(2),F.Pc(n.displayUnit)}}function V(t,e){if(1&t){var n=F.cc();F.bc(0,"div",5),F.bc(1,"div",6),F.bc(2,"label"),F.Oc(3,"Data acquisizione"),F.ac(),F.Wb(4,"zlife-ngrx-custom-picker",7),F.ac(),F.Mc(5,J,7,4,"div",8),F.oc(6,"async"),F.bc(7,"zlife-ngrx-button",9),F.kc("onClick",(function(){return F.Ec(n),F.nc().saveObservation()})),F.ac(),F.ac()}if(2&t){var i=F.nc();F.tc("formGroup",i.addObservationForm),F.Jb(4),F.tc("formControl",i.addObservationForm.controls.dateTime),F.Jb(1),F.tc("ngForOf",F.pc(6,4,i.requestedObservations$)),F.Jb(2),F.tc("isDisabled",!i.addObservationForm.valid)}}var N=function(t){function e(e){var n=t.call(this)||this;return n.store=e,n.isLoading$=n.store.select(k),n.hasError$=n.store.select(_),n.requestedObservations$=n.store.select(z).pipe(Object(v.a)((function(t){var e,i,o={dateTime:new r.a(new Date)};try{for(var a=Object(d.j)(t),s=a.next();!s.done;s=a.next())o[s.value.fhirCode]=new r.a(void 0,[r.l.required])}catch(c){e={error:c}}finally{try{s&&!s.done&&(i=a.return)&&i.call(a)}finally{if(e)throw e.error}}n.addObservationForm=new r.c(o)}))),n}return Object(d.d)(e,t),e.prototype.ngOnDestroy=function(){t.prototype.ngOnDestroy.call(this)},e.prototype.saveObservation=function(){var t=this,e=this.addObservationForm.value;this.requestedObservations$.pipe(Object(b.a)(1)).subscribe((function(n){var i=n.map((function(t){return{code:{code:{code:t.fhirCode,system:t.fhirSystem}},valueQuantity:{value:Number(e[t.fhirCode]),code:t.fhirCode,system:t.fhirSystem,unit:t.fhirUnit}}})),r=m.createObservation({utenteId:1,effectiveDateTime:new Date(e.dateTime).toISOString(),component:i});t.store.dispatch(O({observation:r,dispatchToRemote:!0}))}))},e.\u0275fac=function(t){return new(t||e)(F.Vb(s.h))},e.\u0275cmp=F.Pb({type:e,selectors:[["zlife-aggiungi-misurazione"]],features:[F.Ib([{provide:l.f,useFactory:l.f.create([l.m,"aggiungiMisurazionePage"])}]),F.Gb],decls:11,vars:9,consts:[[1,"container"],[4,"ngIf"],["type","indeterminate",4,"ngIf"],["class","form-container",3,"formGroup",4,"ngIf"],["type","indeterminate"],[1,"form-container",3,"formGroup"],[1,"control"],["elementId","newObservationDateTime",3,"formControl"],["class","control",4,"ngFor","ngForOf"],["text","Salva","type","default","elementId","saveButton",3,"isDisabled","onClick"],["type","number",3,"elementId","formControl"],[1,"unit"]],template:function(t,e){1&t&&(F.bc(0,"ion-header"),F.Wb(1,"zlife-status-bar"),F.ac(),F.bc(2,"ion-content",0),F.bc(3,"h1"),F.Oc(4,"Inserisci la misurazione rilevata"),F.ac(),F.Mc(5,L,6,5,"div",1),F.oc(6,"async"),F.Mc(7,U,1,0,"ion-progress-bar",2),F.oc(8,"async"),F.Mc(9,V,8,6,"div",3),F.oc(10,"async"),F.ac()),2&t&&(F.Jb(5),F.tc("ngIf",F.pc(6,3,e.hasError$)),F.Jb(2),F.tc("ngIf",F.pc(8,5,e.isLoading$)),F.Jb(2),F.tc("ngIf",F.pc(10,7,e.requestedObservations$)))},directives:[o.j,R.a,o.f,i.m,o.l,r.i,r.d,A.a,r.h,r.b,i.l,$.a,q.a],pipes:[i.b,i.g],styles:["[_nghost-%COMP%]{--font-size:var(--font-size-2)}[_nghost-%COMP%]   ion-content[_ngcontent-%COMP%]{--padding-start:16px;--padding-top:16px;--padding-bottom:16px;--padding-end:16px}.form-container[_ngcontent-%COMP%]{background-color:var(--ion-toolbar-background);padding:16px;margin:16px;display:flex;flex-direction:column}.control[_ngcontent-%COMP%]{margin-top:16px;font-size:var(--font-size)}.control[_ngcontent-%COMP%]:first-of-type{margin-top:0}.control[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:var(--font-size)}.control[_ngcontent-%COMP%]   zlife-ngrx-textbox[_ngcontent-%COMP%]{display:inline-block}.control[_ngcontent-%COMP%]   span.unit[_ngcontent-%COMP%]{margin-left:8px}zlife-ngrx-button[_ngcontent-%COMP%]{margin-top:16px;margin-left:auto}"]}),e}(p.g),W=n("67Y/"),Y=function(){function t(t,e){this.store=t,this.router=e}return t.prototype.canActivate=function(t,e){var n=this;return this.store.select((function(t){return t.misurazione.misurazionePage.requestedObservations})).pipe(Object(W.a)((function(t){return(null==t?void 0:t.length)>0})),Object(W.a)((function(e){return e||n.router.navigate(["osservazioni",t.paramMap.get("measure")]),e})))},t.\u0275fac=function(e){return new(e||t)(F.gc(s.h),F.gc(f.j))},t.\u0275prov=F.Rb({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),X=n("atHm"),H=n("wd/R"),B=n("dzgT"),G=n("VnD/"),Q=Object(s.n)("[Feature Misurazione] Load observations",Object(l.s)()),Z=Object(s.n)("[Feature Misurazione] Success load observations",Object(l.s)()),K=Object(s.n)("[Feature Misurazione] Failure load observations",Object(l.s)()),tt=Object(s.n)("[Feature Misurazione] New observations from WebSocket",Object(l.s)()),et=Object(s.n)("[Feature Misurazione] Load intervals",Object(l.s)()),nt=Object(s.n)("[Feature Misurazione] Success load intervals",Object(l.s)()),it=Object(s.n)("[Feature Misurazione] Load intervals",Object(l.s)()),rt=Object(s.n)("[Feature Misurazione] Aggiornamento intervallo grafico",Object(l.s)()),ot=Object(s.n)("[Feature Misurazione] Reset valori del grafico",Object(l.s)()),at=["chart"];function st(t,e){if(1&t&&F.Wb(0,"kendo-chart-series-item",4),2&t){var n=e.$implicit,i=F.nc();F.Kc("smooth"),F.tc("data",n.data)("aggregate",i.avgRoundedWithOneDecimal)("labels",i.pointsLabelsOptions)}}var ct=function(){function t(){var t=this;this.pointsLabelsOptions={color:"white",visible:!0,background:"red",padding:10,margin:5},this.xAxisLabelOptions={content:function(e){var n=H(e.value),i=X.a.getCloserUnitOfTime(t.selectedInterval);return"hours"===i||"days"==i?n.format("HH:mm"):"months"===i?H(t.startDate).isSame(n,"day")||H(t.endDate).isSame(n,"day")||(n.date()+1)%2==0?n.format("D MMM"):"":n.format("D")+"\n"+n.format("MMM")},rotation:"auto"}}return Object.defineProperty(t.prototype,"baseUnit",{get:function(){return this.selectedInterval<=1440?"hours":"days"},enumerable:!0,configurable:!0}),t.prototype.avgRoundedWithOneDecimal=function(t){return t.length>0?Math.round(t.reduce((function(t,e){return e+t}),0)/t.length*10)/10:null},t.prototype.ngOnInit=function(){var t=this;this.valueOptions={min:this.yMin,max:this.yMax,labels:{content:function(e){return e.value+" "+t.unit}}}},t.prototype.ngOnChanges=function(t){if(t.values){var e=this.values.some((function(t){return t.data.some((function(t){return null===t.y}))}));this.valueOptions=this.valueOptions||{},this.valueOptions.min=e?this.yMin:null,this.valueOptions.max=e?this.yMax:null,this.kendoChart.notifyChanges({valueAxis:this.valueOptions})}},t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=F.Pb({type:t,selectors:[["zlife-graph"]],viewQuery:function(t,e){var n;1&t&&F.Jc(at,!0),2&t&&F.Cc(n=F.lc())&&(e.kendoChart=n.first)},inputs:{values:"values",startDate:"startDate",endDate:"endDate",selectedInterval:"selectedInterval",yMin:"yMin",yMax:"yMax",unit:"unit"},features:[F.Hb],decls:6,vars:6,consts:[[3,"valueAxis"],["chart",""],["type","line","field","y","categoryField","x",3,"data","style","aggregate","labels",4,"ngFor","ngForOf"],[3,"min","max","baseUnit","labels"],["type","line","field","y","categoryField","x",3,"data","aggregate","labels"]],template:function(t,e){1&t&&(F.bc(0,"kendo-chart",0,1),F.bc(2,"kendo-chart-series"),F.Mc(3,st,1,5,"kendo-chart-series-item",2),F.ac(),F.bc(4,"kendo-chart-category-axis"),F.Wb(5,"kendo-chart-category-axis-item",3),F.ac(),F.ac()),2&t&&(F.tc("valueAxis",e.valueOptions),F.Jb(3),F.tc("ngForOf",e.values),F.Jb(2),F.tc("min",e.startDate)("max",e.endDate)("baseUnit",e.baseUnit)("labels",e.xAxisLabelOptions))},directives:[u.c,u.e,i.l,u.a,u.b,u.f],styles:["kendo-chart[_ngcontent-%COMP%]{height:100%;padding:16px}"],changeDetection:0}),t}(),ut=function(){function t(){}return t.prototype.transform=function(t,e){return void 0===e&&(e="minutes"),H.duration(t,e).humanize()},t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=F.Ub({name:"humanize",type:t,pure:!0}),t}();function lt(t,e){if(1&t&&(F.bc(0,"div"),F.Oc(1," Si \xe8 verificato un problema. "),F.bc(2,"pre"),F.Oc(3),F.oc(4,"json"),F.oc(5,"async"),F.ac(),F.ac()),2&t){var n=F.nc();F.Jb(3),F.Pc(F.pc(4,1,F.pc(5,3,n.hasError$)))}}function ht(t,e){1&t&&F.Wb(0,"ion-progress-bar",6)}function pt(t,e){if(1&t){var n=F.cc();F.bc(0,"zlife-ngrx-button",17),F.kc("onClick",(function(){F.Ec(n);var t=e.$implicit;return F.nc(3).setGraphRange(t.valueInMinutes)})),F.oc(1,"async"),F.oc(2,"humanize"),F.ac()}if(2&t){var i=e.$implicit,r=F.nc(3);F.Nb("selected",i.valueInMinutes==F.pc(1,4,r.selectedInterval$)),F.tc("elementId","btn"+i.valueInMinutes)("text",F.pc(2,6,i.valueInMinutes))}}function ft(t,e){if(1&t){var n=F.cc();F.bc(0,"div",10),F.bc(1,"div",11),F.bc(2,"zlife-ngrx-button",12),F.kc("onClick",(function(){return F.Ec(n),F.nc(2).backButton()})),F.ac(),F.bc(3,"p",13),F.Oc(4),F.oc(5,"async"),F.ac(),F.bc(6,"zlife-ngrx-button",14),F.kc("onClick",(function(){return F.Ec(n),F.nc(2).forwardButton()})),F.ac(),F.ac(),F.bc(7,"div",15),F.Mc(8,pt,3,8,"zlife-ngrx-button",16),F.oc(9,"async"),F.ac(),F.ac()}if(2&t){var i=F.nc(2);F.Jb(2),F.tc("isIonicons",!0),F.Jb(2),F.Pc(F.pc(5,4,i.displayedInterval$)),F.Jb(2),F.tc("isIonicons",!0),F.Jb(2),F.tc("ngForOf",F.pc(9,6,i.intervals$))}}function dt(t,e){if(1&t&&(F.bc(0,"div",7),F.Mc(1,ft,10,8,"div",8),F.oc(2,"async"),F.Wb(3,"zlife-graph",9),F.oc(4,"async"),F.oc(5,"async"),F.oc(6,"async"),F.oc(7,"async"),F.oc(8,"async"),F.oc(9,"async"),F.ac()),2&t){var n=F.nc();F.Jb(1),F.tc("ngIf",F.pc(2,8,n.selectedInterval$)),F.Jb(2),F.tc("values",n.simplifiedValuesForPlotting)("startDate",F.pc(4,10,n.startDate$))("endDate",F.pc(5,12,n.endDate$))("selectedInterval",F.pc(6,14,n.selectedInterval$))("yMin",null==F.pc(7,16,n.requestedObservations$)[0]?null:F.pc(7,16,n.requestedObservations$)[0].minValue)("yMax",null==F.pc(8,18,n.requestedObservations$)[0]?null:F.pc(8,18,n.requestedObservations$)[0].maxValue)("unit",null==F.pc(9,20,n.requestedObservations$)[0]?null:F.pc(9,20,n.requestedObservations$)[0].displayUnit)}}function vt(t,e){if(1&t&&(F.bc(0,"div",19),F.bc(1,"span",20),F.Oc(2),F.ac(),F.bc(3,"div",21),F.bc(4,"span",22),F.Oc(5),F.ac(),F.bc(6,"span",23),F.Oc(7),F.ac(),F.bc(8,"span",24),F.Oc(9,"min"),F.ac(),F.ac(),F.bc(10,"div",21),F.bc(11,"span",22),F.Oc(12),F.ac(),F.bc(13,"span",23),F.Oc(14),F.ac(),F.bc(15,"span",24),F.Oc(16,"max"),F.ac(),F.ac(),F.bc(17,"div",21),F.bc(18,"span",22),F.Oc(19),F.ac(),F.bc(20,"span",23),F.Oc(21),F.ac(),F.bc(22,"span",24),F.Oc(23,"media"),F.ac(),F.ac(),F.ac()),2&t){var n=e.$implicit;F.Jb(2),F.Qc(" ",n.display," "),F.Jb(3),F.Qc(" ",n.summaryLabels.min?n.summaryLabels.min:"---"," "),F.Jb(2),F.Qc(" ",n.unit," "),F.Jb(5),F.Qc(" ",n.summaryLabels.max?n.summaryLabels.max:"---"," "),F.Jb(2),F.Qc(" ",n.unit," "),F.Jb(5),F.Qc(" ",n.summaryLabels.avg?n.summaryLabels.avg:"---"," "),F.Jb(2),F.Qc(" ",n.unit," ")}}function bt(t,e){if(1&t&&(F.bc(0,"div"),F.Mc(1,vt,24,7,"div",18),F.ac()),2&t){var n=F.nc();F.Jb(1),F.tc("ngForOf",n.simplifiedValuesForPlotting)}}function gt(t,e){if(1&t){var n=F.cc();F.bc(0,"zlife-ngrx-button",25),F.kc("onClick",(function(){return F.Ec(n),F.nc().addObservation()})),F.ac()}if(2&t){var i=F.nc();F.tc("icon",i.iconForAddObservationButton)("isRaised",!0)}}var mt=[{path:"",component:function(){function t(t,e,n){this.store=t,this.activatedRoute=e,this.router=n}return t.prototype.ngOnInit=function(){var t,e=this,n=this.activatedRoute.snapshot.params.measure;switch(n){case"pressione":case"pressioneMax":case"pressioneMin":t=[y.pressioneMin,y.pressioneMax];break;default:t=[y[n]]}t.some((function(t){return void 0===t}))?console.error(new Error("Expected URL parameter 'measure' to be one of "+Object.keys(y).join(", ")+" but got '"+n+"'.")):(this.iconForAddObservationButton=t[0].icon,this.store.dispatch(et({forObservations:t,url:n,dispatchToRemote:!1})),this.intervals$=this.store.select(D),this.selectedInterval$=this.store.select(C),this.isLoading$=this.store.select(P),this.hasError$=this.store.select(I),this.startDate$=this.store.select(E),this.endDate$=this.store.select(S),this.requestedObservations$=this.store.select(z),this.displayedInterval$=Object(B.a)([this.startDate$,this.endDate$,this.selectedInterval$]).pipe(Object(W.a)((function(t){var e=H(t[0]),n=H(t[1]);return"hours"===X.a.getCloserUnitOfTime(t[2])?e.format("D MMM, HH:mm"):e.month()===n.month()?e.format("D")+" - "+n.format("D MMMM"):e.format("D MMM")+" - "+n.format("D MMM")}))),this.observations$=this.store.select(x).pipe(Object(G.a)((function(t){return!!t})),Object(v.a)((function(t){var n,i;if(0!==t.length){var r=t.flatMap((function(t){return t.component.map((function(t){return{code:t.code.code.code,system:t.code.code.system}}))})),o=X.a.removeDuplicates(r),a=t.flatMap((function(t){return t.component.map((function(e){return{effectiveDateTime:t.effectiveDateTime,code:e.code.code.code,system:e.code.code.system,value:Math.round(10*e.valueQuantity.value)/10,unit:m.getMappingByCode(e.code.code.code).observation.displayUnit}}))})),s=[],c=function(t,e){var n=a.filter((function(n){return n.code===t&&n.system===e})),i=m.getMappingByCode(t),r=n.map((function(t){return new Date(t.effectiveDateTime)})),o=n.map((function(t){return t.value})),c={display:i.observation.display,unit:i.observation.displayUnit,summaryLabels:{min:Math.min.apply(Math,Object(d.h)(o)),max:Math.max.apply(Math,Object(d.h)(o)),avg:Math.round(o.reduce((function(t,e){return t+e}),0)/o.length*10)/10},data:r.map((function(t,e){return{x:t,y:o[e]}}))};s.push(c)};try{for(var u=Object(d.j)(o),l=u.next();!l.done;l=u.next()){var h=l.value;c(h.code,h.system)}}catch(p){n={error:p}}finally{try{l&&!l.done&&(i=u.return)&&i.call(u)}finally{if(n)throw n.error}}e.simplifiedValuesForPlotting=s}else e.store.select(T).pipe(Object(b.a)(1)).subscribe((function(t){e.simplifiedValuesForPlotting=t.misurazionePage.requestedObservations.map((function(e){return{display:e.display,unit:e.displayUnit,summaryLabels:{avg:null,max:null,min:null},data:[{x:new Date(t.misurazionePage.startDate),y:null},{x:new Date(t.misurazionePage.endDate),y:null}]}}))}))}))))},t.prototype.ionViewWillEnter=function(){var t=this;this.store.select(T).pipe(Object(b.a)(1),Object(G.a)((function(t){return!!t.misurazionePage.startDate&&!!t.misurazionePage.endDate})),Object(l.n)(this.store)).subscribe((function(e){t.store.dispatch(Q({startDate:e.misurazionePage.startDate,endDate:e.misurazionePage.endDate,forObservations:e.misurazionePage.requestedObservations,dispatchToRemote:!0}))}))},t.prototype.setGraphRange=function(t){var e=Object(d.g)(X.a.getDateRangeFromNow(t),2),n=e[1];this.store.dispatch(rt({selectedInterval:t,startDate:e[0].toISOString(),endDate:n.toISOString(),dispatchToRemote:!0}))},t.prototype.backButton=function(){var t=this;Object(B.a)([this.startDate$,this.selectedInterval$]).pipe(Object(b.a)(1)).subscribe((function(e){var n=Object(d.g)(e,2),i=n[0],r=n[1],o=Object(d.g)(X.a.getDateRangeFrom(i,r,"back"),2),a=o[1];t.store.dispatch(rt({selectedInterval:r,startDate:o[0].toISOString(),endDate:a.toISOString(),dispatchToRemote:!0}))}))},t.prototype.forwardButton=function(){var t=this;Object(B.a)([this.startDate$,this.selectedInterval$]).pipe(Object(b.a)(1)).subscribe((function(e){var n=Object(d.g)(e,2),i=n[0],r=n[1],o=Object(d.g)(X.a.getDateRangeFrom(i,r,"forward"),2),a=o[1];t.store.dispatch(rt({selectedInterval:r,startDate:o[0].toISOString(),endDate:a.toISOString(),dispatchToRemote:!0}))}))},t.prototype.addObservation=function(){this.router.navigate(["aggiungi"],{relativeTo:this.activatedRoute})},t.prototype.ionViewDidLeave=function(){this.store.dispatch(ot({dispatchToRemote:!1}))},t.\u0275fac=function(e){return new(e||t)(F.Vb(s.h),F.Vb(f.a),F.Vb(f.j))},t.\u0275cmp=F.Pb({type:t,selectors:[["zlife-misurazioni"]],features:[F.Ib([{provide:l.f,useFactory:l.f.create([l.m,"misurazionePage"])}])],decls:15,vars:17,consts:[["title","Misurazioni"],["padding",""],[4,"ngIf"],["type","indeterminate",4,"ngIf"],["class","content",4,"ngIf"],["elementId","btnMeasure","text","Misura","class","add-observation",3,"icon","isRaised","onClick",4,"ngIf"],["type","indeterminate"],[1,"content"],["class","","class","toolbar",4,"ngIf"],[3,"values","startDate","endDate","selectedInterval","yMin","yMax","unit"],[1,"toolbar"],[1,"back-forward-buttons-container"],["icon","arrow-back-outline","type","round","elementId","btnPrev",3,"isIonicons","onClick"],[1,"interval"],["icon","arrow-forward-outline","type","round","elementId","btnNext",3,"isIonicons","onClick"],[1,"intervals-buttons-container"],[3,"elementId","text","selected","onClick",4,"ngFor","ngForOf"],[3,"elementId","text","onClick"],["class","serie-container",4,"ngFor","ngForOf"],[1,"serie-container"],[1,"summary-serie-display"],[1,"summary-label"],[1,"summary-value"],[1,"summary-unit"],[1,"summary-meaning"],["elementId","btnMeasure","text","Misura",1,"add-observation",3,"icon","isRaised","onClick"]],template:function(t,e){1&t&&(F.bc(0,"ion-header"),F.Wb(1,"zlife-status-bar",0),F.ac(),F.bc(2,"ion-content",1),F.Mc(3,lt,6,5,"div",2),F.oc(4,"async"),F.Mc(5,ht,1,0,"ion-progress-bar",3),F.oc(6,"async"),F.Mc(7,dt,10,22,"div",4),F.oc(8,"async"),F.oc(9,"async"),F.oc(10,"async"),F.oc(11,"async"),F.ac(),F.bc(12,"zlife-footer"),F.Mc(13,bt,2,1,"div",2),F.Mc(14,gt,1,2,"zlife-ngrx-button",5),F.ac()),2&t&&(F.Jb(3),F.tc("ngIf",F.pc(4,5,e.hasError$)),F.Jb(2),F.tc("ngIf",F.pc(6,7,e.isLoading$)),F.Jb(2),F.tc("ngIf",F.pc(8,9,e.intervals$)&&F.pc(9,11,e.observations$)&&F.pc(10,13,e.startDate$)&&F.pc(11,15,e.endDate$)),F.Jb(6),F.tc("ngIf",e.simplifiedValuesForPlotting),F.Jb(1),F.tc("ngIf",e.iconForAddObservationButton))},directives:[o.j,R.a,o.f,i.m,p.h,o.l,ct,$.a,i.l],pipes:[i.b,i.g,ut],styles:[".content[_ngcontent-%COMP%]{height:calc(100% - 98px)}.toolbar[_ngcontent-%COMP%]{display:flex;flex-direction:row;padding:16px}.back-forward-buttons-container[_ngcontent-%COMP%]{display:flex;align-items:center}.back-forward-buttons-container[_ngcontent-%COMP%]   zlife-ngrx-button[_ngcontent-%COMP%]{--border-hover:4px solid var(--ion-color-tertiary);--background-color-hover:var(--ion-color-tertiary);--font-color-hover:var(--ion-color-dark)}.back-forward-buttons-container[_ngcontent-%COMP%]   p.interval[_ngcontent-%COMP%]{padding:8px}.intervals-buttons-container[_ngcontent-%COMP%]{display:flex;align-items:center;flex:1;justify-content:flex-end}.intervals-buttons-container[_ngcontent-%COMP%]   zlife-ngrx-button[_ngcontent-%COMP%]{--border:4px solid var(--ion-color-tertiary);--background-color:#fff;--border-hover:4px solid var(--ion-color-tertiary);--background-color-hover:var(--ion-color-tertiary);--font-color-hover:var(--ion-color-dark);margin-left:4px;margin-right:4px}.intervals-buttons-container[_ngcontent-%COMP%]   zlife-ngrx-button[_ngcontent-%COMP%]:last-child{margin-right:0}.intervals-buttons-container[_ngcontent-%COMP%]   zlife-ngrx-button[_ngcontent-%COMP%]:first-child{margin-left:0}.intervals-buttons-container[_ngcontent-%COMP%]   zlife-ngrx-button.selected[_ngcontent-%COMP%]{--border:4px solid var(--ion-color-tertiary);--background-color:var(--ion-color-tertiary);--font-color:var(--ion-color-dark)}zlife-ngrx-button.add-observation[_ngcontent-%COMP%]{margin-left:auto;--default-font-size:var(--font-size-7);--border:2px solid var(--ion-border-color);--background-color:#fff;--border-hover:2px solid var(--ion-border-color);--background-color-hover:var(--ion-color-light);--font-color-hover:var(--ion-color-dark);--padding:16px 32px 16px 32px;--font-weight:600}zlife-footer[_ngcontent-%COMP%]{display:flex}.serie-container[_ngcontent-%COMP%]{display:inline-block;text-align:center}.serie-container[_ngcontent-%COMP%]   .summary-serie-display[_ngcontent-%COMP%]{display:block;padding-bottom:10px}.serie-container[_ngcontent-%COMP%]   .summary-label[_ngcontent-%COMP%]{background-color:#fff;text-align:center;display:inline-block;margin:10px;padding:10px}.serie-container[_ngcontent-%COMP%]   .summary-label[_ngcontent-%COMP%]   .summary-value[_ngcontent-%COMP%]{font-size:var(--font-size-7);font-weight:700}.serie-container[_ngcontent-%COMP%]   .summary-label[_ngcontent-%COMP%]   .summary-meaning[_ngcontent-%COMP%]{display:block}ion-skeleton-text[_ngcontent-%COMP%]{margin-left:16px;display:inline-block}ion-skeleton-text[_ngcontent-%COMP%]:first-of-type{margin-left:0}"]}),t}()},{path:"aggiungi",component:N,canActivate:[Y]}],yt=function(){function t(){}return t.\u0275mod=F.Tb({type:t}),t.\u0275inj=F.Sb({factory:function(e){return new(e||t)},imports:[[f.l.forChild(mt)],f.l]}),t}(),Ot=n("Eoaw"),Mt=n("F/XL"),jt=n("15JJ"),Tt=n("9Z1F"),xt=n("/PH2"),Dt=n("AytR"),Ct=n("cUzu"),Pt=n("Kp+N"),It=function(){function t(t,e,n){var i=this;this.http=t,this.store=e,this.socket=n,this.socket.fromEvent("user/MisurazioniStateUpdate").subscribe((function(t){i.store.dispatch(tt({observations:t,dispatchToRemote:!0}))}))}return t.prototype.getObservations=function(t,e,n){var i=Object(d.h)(m.buildCriteriaForDatePeriod("date",e,n),m.buildCriteria(t.map((function(t){return{fhirField:"component-code",value:t.fhirCode,system:t.fhirSystem}}))));return this.http.post(Dt.a.server.fhir+"/services/app/fhir/observation/search",{criteria:i}).pipe(Object(W.a)((function(t){return t.result})))},t.prototype.addObservation=function(t){return this.http.post(Dt.a.server.fhir+"/services/app/fhir/observation",t)},t.prototype.getIntervals=function(t){return this.http.post(Dt.a.server.url+"/observations/intervals",{fhirCode:t[0].fhirCode,fhirSystem:t[0].fhirSystem})},t.\u0275fac=function(e){return new(e||t)(F.gc(Ct.b),F.gc(s.h),F.gc(Pt.a))},t.\u0275prov=F.Rb({token:t,factory:t.\u0275fac,providedIn:"root"}),t}(),zt=function(){function t(t,e,n,i){var r=this;this.actions$=t,this.misurazioneService=e,this.store=n,this.router=i,this.onAddObservation$=Object(a.c)((function(){return r.actions$.pipe(Object(a.d)(O),Object(Ot.a)(r.store),Object(jt.a)((function(t){return r.misurazioneService.addObservation(t.observation).pipe(Object(W.a)((function(){return M({dispatchToRemote:!0})})),Object(Tt.a)((function(t){return Object(Mt.a)(j({error:t,dispatchToRemote:!0}))})))})))})),this.onAddObservationSuccess$=Object(a.c)((function(){return r.actions$.pipe(Object(a.d)(M),Object(xt.a)(r.store.select(w)),Object(v.a)((function(t){var e=Object(d.g)(t,2);r.router.navigate(["osservazioni",e[1]])})))}),{dispatch:!1})}return t.\u0275fac=function(e){return new(e||t)(F.gc(a.a),F.gc(It),F.gc(s.h),F.gc(f.j))},t.\u0275prov=F.Rb({token:t,factory:t.\u0275fac}),t}(),Et=function(){function t(t,e,n){var i=this;this.actions$=t,this.misurazioneService=e,this.store=n,this.onLoadIntervals$=Object(a.c)((function(){return i.actions$.pipe(Object(a.d)(et),Object(jt.a)((function(t){return i.misurazioneService.getIntervals(t.forObservations).pipe(Object(W.a)((function(e){var n=e.find((function(t){return t.isDefault})).valueInMinutes,i=Object(d.g)(X.a.getDateRangeFromNow(n),2),r=i[1];return nt({intervals:e,startDate:i[0].toISOString(),endDate:r.toISOString(),forObservations:t.forObservations,dispatchToRemote:!0})})),Object(Tt.a)((function(t){return Object(Mt.a)(it({error:t,dispatchToRemote:!0}))})))})))})),this.onAfterIntervalsLoaded$=Object(a.c)((function(){return i.actions$.pipe(Object(a.d)(nt),Object(W.a)((function(t){return Q({forObservations:t.forObservations,startDate:t.startDate,endDate:t.endDate,dispatchToRemote:!1})})))})),this.onObservationsRequest$=Object(a.c)((function(){return i.actions$.pipe(Object(a.d)(Q),Object(jt.a)((function(t){return i.misurazioneService.getObservations(t.forObservations,new Date(t.startDate),new Date(t.endDate)).pipe(Object(W.a)((function(t){return Z({observations:t,dispatchToRemote:!0})})),Object(Tt.a)((function(t){return Object(Mt.a)(K({error:t,dispatchToRemote:!0}))})))})))})),this.onAfterIntervalUpdate$=Object(a.c)((function(){return i.actions$.pipe(Object(a.d)(rt),Object(xt.a)(i.store.select(T)),Object(W.a)((function(t){var e=Object(d.g)(t,2)[1];return Q({forObservations:e.misurazionePage.requestedObservations,startDate:e.misurazionePage.startDate,endDate:e.misurazionePage.endDate,dispatchToRemote:!0})})))}))}return t.\u0275fac=function(e){return new(e||t)(F.gc(a.a),F.gc(It),F.gc(s.h))},t.\u0275prov=F.Rb({token:t,factory:t.\u0275fac}),t}(),St=Object(s.p)({isLoading:!1},Object(s.r)(O,(function(t,e){return Object(d.a)(Object(d.a)({},t),{isLoading:!0})})),Object(s.r)(M,(function(t,e){return Object(d.a)(Object(d.a)({},t),{isLoading:!1})})),Object(s.r)(j,(function(t,e){return Object(d.a)(Object(d.a)({},t),{isLoading:!1,error:e.error})}))),wt=Object(s.p)({isLoading:!0,requestedObservations:null,observations:null,intervals:null,startDate:null,endDate:null,selectedInterval:null,currentObservationUrl:null},Object(s.r)(et,(function(t,e){return Object(d.a)(Object(d.a)({},t),{isLoading:!0,requestedObservations:e.forObservations,currentObservationUrl:e.url})})),Object(s.r)(nt,(function(t,e){return Object(d.a)(Object(d.a)({},t),{intervals:e.intervals,selectedInterval:e.intervals.find((function(t){return t.isDefault})).valueInMinutes,startDate:e.startDate,endDate:e.endDate})})),Object(s.r)(it,(function(t,e){return Object(d.a)(Object(d.a)({},t),{isLoading:!1,error:e.error})})),Object(s.r)(Q,(function(t,e){return Object(d.a)(Object(d.a)({},t),{observations:[],isLoading:!0})})),Object(s.r)(Z,(function(t,e){return Object(d.a)(Object(d.a)({},t),{observations:Object(d.h)(e.observations),isLoading:!1})})),Object(s.r)(K,(function(t,e){return Object(d.a)(Object(d.a)({},t),{isLoading:!1,error:e.error})})),Object(s.r)(tt,(function(t,e){return Object(d.a)(Object(d.a)({},t),{observations:Object(d.h)(t.observations,e.observations)})})),Object(s.r)(rt,(function(t,e){return Object(d.a)(Object(d.a)({},t),{startDate:e.startDate,endDate:e.endDate,selectedInterval:e.selectedInterval,observations:[]})})),Object(s.r)(ot,(function(t,e){return Object(d.a)(Object(d.a)({},t),{observations:[]})}))),kt=function(){function t(){}return t.\u0275mod=F.Tb({type:t}),t.\u0275inj=F.Sb({factory:function(e){return new(e||t)},imports:[[i.c,yt,o.q,l.b,u.d,h.a,c.b,c.c,s.j.forFeature(l.m,{misurazionePage:wt,aggiungiMisurazionePage:St}),a.b.forFeature([Et,zt]),r.k,p.a]]}),t}()},yLV6:function(t,e,n){var i;!function(r,o,a,s){"use strict";var c,u=["","webkit","Moz","MS","ms","o"],l=o.createElement("div"),h=Math.round,p=Math.abs,f=Date.now;function d(t,e,n){return setTimeout(M(t,n),e)}function v(t,e,n){return!!Array.isArray(t)&&(b(t,n[e],n),!0)}function b(t,e,n){var i;if(t)if(t.forEach)t.forEach(e,n);else if(void 0!==t.length)for(i=0;i<t.length;)e.call(n,t[i],i,t),i++;else for(i in t)t.hasOwnProperty(i)&&e.call(n,t[i],i,t)}function g(t,e,n){var i="DEPRECATED METHOD: "+e+"\n"+n+" AT \n";return function(){var e=new Error("get-stack-trace"),n=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",o=r.console&&(r.console.warn||r.console.log);return o&&o.call(r.console,i,n),t.apply(this,arguments)}}c="function"!=typeof Object.assign?function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var i=arguments[n];if(null!=i)for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])}return e}:Object.assign;var m=g((function(t,e,n){for(var i=Object.keys(e),r=0;r<i.length;)(!n||n&&void 0===t[i[r]])&&(t[i[r]]=e[i[r]]),r++;return t}),"extend","Use `assign`."),y=g((function(t,e){return m(t,e,!0)}),"merge","Use `assign`.");function O(t,e,n){var i,r=e.prototype;(i=t.prototype=Object.create(r)).constructor=t,i._super=r,n&&c(i,n)}function M(t,e){return function(){return t.apply(e,arguments)}}function j(t,e){return"function"==typeof t?t.apply(e&&e[0]||void 0,e):t}function T(t,e){return void 0===t?e:t}function x(t,e,n){b(I(e),(function(e){t.addEventListener(e,n,!1)}))}function D(t,e,n){b(I(e),(function(e){t.removeEventListener(e,n,!1)}))}function C(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function P(t,e){return t.indexOf(e)>-1}function I(t){return t.trim().split(/\s+/g)}function z(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);for(var i=0;i<t.length;){if(n&&t[i][n]==e||!n&&t[i]===e)return i;i++}return-1}function E(t){return Array.prototype.slice.call(t,0)}function S(t,e,n){for(var i=[],r=[],o=0;o<t.length;){var a=e?t[o][e]:t[o];z(r,a)<0&&i.push(t[o]),r[o]=a,o++}return n&&(i=e?i.sort((function(t,n){return t[e]>n[e]})):i.sort()),i}function w(t,e){for(var n,i,r=e[0].toUpperCase()+e.slice(1),o=0;o<u.length;){if((i=(n=u[o])?n+r:e)in t)return i;o++}}var k=1;function _(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||r}var F="ontouchstart"in r,R=void 0!==w(r,"PointerEvent"),A=F&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),$=["x","y"],q=["clientX","clientY"];function L(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){j(t.options.enable,[t])&&n.handler(e)},this.init()}function U(t,e,n){var i=n.pointers.length,r=n.changedPointers.length,o=1&e&&i-r==0,a=12&e&&i-r==0;n.isFirst=!!o,n.isFinal=!!a,o&&(t.session={}),n.eventType=e,function(t,e){var n=t.session,i=e.pointers,r=i.length;n.firstInput||(n.firstInput=J(e)),r>1&&!n.firstMultiple?n.firstMultiple=J(e):1===r&&(n.firstMultiple=!1);var o=n.firstInput,a=n.firstMultiple,s=a?a.center:o.center,c=e.center=V(i);e.timeStamp=f(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=X(s,c),e.distance=Y(s,c),function(t,e){var n=e.center,i=t.offsetDelta||{},r=t.prevDelta||{},o=t.prevInput||{};1!==e.eventType&&4!==o.eventType||(r=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},i=t.offsetDelta={x:n.x,y:n.y}),e.deltaX=r.x+(n.x-i.x),e.deltaY=r.y+(n.y-i.y)}(n,e),e.offsetDirection=W(e.deltaX,e.deltaY);var u,l,h=N(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=h.x,e.overallVelocityY=h.y,e.overallVelocity=p(h.x)>p(h.y)?h.x:h.y,e.scale=a?(u=a.pointers,Y((l=i)[0],l[1],q)/Y(u[0],u[1],q)):1,e.rotation=a?function(t,e){return X(e[1],e[0],q)+X(t[1],t[0],q)}(a.pointers,i):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,function(t,e){var n,i,r,o,a=t.lastInterval||e,s=e.timeStamp-a.timeStamp;if(8!=e.eventType&&(s>25||void 0===a.velocity)){var c=e.deltaX-a.deltaX,u=e.deltaY-a.deltaY,l=N(s,c,u);i=l.x,r=l.y,n=p(l.x)>p(l.y)?l.x:l.y,o=W(c,u),t.lastInterval=e}else n=a.velocity,i=a.velocityX,r=a.velocityY,o=a.direction;e.velocity=n,e.velocityX=i,e.velocityY=r,e.direction=o}(n,e);var d=t.element;C(e.srcEvent.target,d)&&(d=e.srcEvent.target),e.target=d}(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function J(t){for(var e=[],n=0;n<t.pointers.length;)e[n]={clientX:h(t.pointers[n].clientX),clientY:h(t.pointers[n].clientY)},n++;return{timeStamp:f(),pointers:e,center:V(e),deltaX:t.deltaX,deltaY:t.deltaY}}function V(t){var e=t.length;if(1===e)return{x:h(t[0].clientX),y:h(t[0].clientY)};for(var n=0,i=0,r=0;r<e;)n+=t[r].clientX,i+=t[r].clientY,r++;return{x:h(n/e),y:h(i/e)}}function N(t,e,n){return{x:e/t||0,y:n/t||0}}function W(t,e){return t===e?1:p(t)>=p(e)?t<0?2:4:e<0?8:16}function Y(t,e,n){n||(n=$);var i=e[n[0]]-t[n[0]],r=e[n[1]]-t[n[1]];return Math.sqrt(i*i+r*r)}function X(t,e,n){return n||(n=$),180*Math.atan2(e[n[1]]-t[n[1]],e[n[0]]-t[n[0]])/Math.PI}L.prototype={handler:function(){},init:function(){this.evEl&&x(this.element,this.evEl,this.domHandler),this.evTarget&&x(this.target,this.evTarget,this.domHandler),this.evWin&&x(_(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&D(this.element,this.evEl,this.domHandler),this.evTarget&&D(this.target,this.evTarget,this.domHandler),this.evWin&&D(_(this.element),this.evWin,this.domHandler)}};var H={mousedown:1,mousemove:2,mouseup:4};function B(){this.evEl="mousedown",this.evWin="mousemove mouseup",this.pressed=!1,L.apply(this,arguments)}O(B,L,{handler:function(t){var e=H[t.type];1&e&&0===t.button&&(this.pressed=!0),2&e&&1!==t.which&&(e=4),this.pressed&&(4&e&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}});var G={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},Q={2:"touch",3:"pen",4:"mouse",5:"kinect"},Z="pointerdown",K="pointermove pointerup pointercancel";function tt(){this.evEl=Z,this.evWin=K,L.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}r.MSPointerEvent&&!r.PointerEvent&&(Z="MSPointerDown",K="MSPointerMove MSPointerUp MSPointerCancel"),O(tt,L,{handler:function(t){var e=this.store,n=!1,i=t.type.toLowerCase().replace("ms",""),r=G[i],o=Q[t.pointerType]||t.pointerType,a="touch"==o,s=z(e,t.pointerId,"pointerId");1&r&&(0===t.button||a)?s<0&&(e.push(t),s=e.length-1):12&r&&(n=!0),s<0||(e[s]=t,this.callback(this.manager,r,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),n&&e.splice(s,1))}});var et={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function nt(){this.evTarget="touchstart",this.evWin="touchstart touchmove touchend touchcancel",this.started=!1,L.apply(this,arguments)}function it(t,e){var n=E(t.touches),i=E(t.changedTouches);return 12&e&&(n=S(n.concat(i),"identifier",!0)),[n,i]}O(nt,L,{handler:function(t){var e=et[t.type];if(1===e&&(this.started=!0),this.started){var n=it.call(this,t,e);12&e&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:t})}}});var rt={touchstart:1,touchmove:2,touchend:4,touchcancel:8};function ot(){this.evTarget="touchstart touchmove touchend touchcancel",this.targetIds={},L.apply(this,arguments)}function at(t,e){var n=E(t.touches),i=this.targetIds;if(3&e&&1===n.length)return i[n[0].identifier]=!0,[n,n];var r,o,a=E(t.changedTouches),s=[],c=this.target;if(o=n.filter((function(t){return C(t.target,c)})),1===e)for(r=0;r<o.length;)i[o[r].identifier]=!0,r++;for(r=0;r<a.length;)i[a[r].identifier]&&s.push(a[r]),12&e&&delete i[a[r].identifier],r++;return s.length?[S(o.concat(s),"identifier",!0),s]:void 0}function st(){L.apply(this,arguments);var t=M(this.handler,this);this.touch=new ot(this.manager,t),this.mouse=new B(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function ct(t,e){1&t?(this.primaryTouch=e.changedPointers[0].identifier,ut.call(this,e)):12&t&&ut.call(this,e)}function ut(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var i=this.lastTouches;setTimeout((function(){var t=i.indexOf(n);t>-1&&i.splice(t,1)}),2500)}}function lt(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,i=0;i<this.lastTouches.length;i++){var r=this.lastTouches[i],o=Math.abs(e-r.x),a=Math.abs(n-r.y);if(o<=25&&a<=25)return!0}return!1}O(ot,L,{handler:function(t){var e=rt[t.type],n=at.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:"touch",srcEvent:t})}}),O(st,L,{handler:function(t,e,n){var i="mouse"==n.pointerType;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if("touch"==n.pointerType)ct.call(this,e,n);else if(i&&lt.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var ht=w(l.style,"touchAction"),pt=void 0!==ht,ft=function(){if(!pt)return!1;var t={},e=r.CSS&&r.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){t[n]=!e||r.CSS.supports("touch-action",n)})),t}();function dt(t,e){this.manager=t,this.set(e)}function vt(t){this.options=c({},this.defaults,t||{}),this.id=k++,this.manager=null,this.options.enable=T(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function bt(t){return 16&t?"cancel":8&t?"end":4&t?"move":2&t?"start":""}function gt(t){return 16==t?"down":8==t?"up":2==t?"left":4==t?"right":""}function mt(t,e){var n=e.manager;return n?n.get(t):t}function yt(){vt.apply(this,arguments)}function Ot(){yt.apply(this,arguments),this.pX=null,this.pY=null}function Mt(){yt.apply(this,arguments)}function jt(){vt.apply(this,arguments),this._timer=null,this._input=null}function Tt(){yt.apply(this,arguments)}function xt(){yt.apply(this,arguments)}function Dt(){vt.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Ct(t,e){return(e=e||{}).recognizers=T(e.recognizers,Ct.defaults.preset),new Pt(t,e)}function Pt(t,e){var n;this.options=c({},Ct.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=new((n=this).options.inputClass||(R?tt:A?ot:F?st:B))(n,U),this.touchAction=new dt(this,this.options.touchAction),It(this,!0),b(this.options.recognizers,(function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}function It(t,e){var n,i=t.element;i.style&&(b(t.options.cssProps,(function(r,o){n=w(i.style,o),e?(t.oldCssProps[n]=i.style[n],i.style[n]=r):i.style[n]=t.oldCssProps[n]||""})),e||(t.oldCssProps={}))}dt.prototype={set:function(t){"compute"==t&&(t=this.compute()),pt&&this.manager.element.style&&ft[t]&&(this.manager.element.style[ht]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return b(this.manager.recognizers,(function(e){j(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),function(t){if(P(t,"none"))return"none";var e=P(t,"pan-x"),n=P(t,"pan-y");return e&&n?"none":e||n?e?"pan-x":"pan-y":P(t,"manipulation")?"manipulation":"auto"}(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var i=this.actions,r=P(i,"none")&&!ft.none,o=P(i,"pan-y")&&!ft["pan-y"],a=P(i,"pan-x")&&!ft["pan-x"];if(r&&1===t.pointers.length&&t.distance<2&&t.deltaTime<250)return;if(!a||!o)return r||o&&6&n||a&&24&n?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}},vt.prototype={defaults:{},set:function(t){return c(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(v(t,"recognizeWith",this))return this;var e=this.simultaneous;return e[(t=mt(t,this)).id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return v(t,"dropRecognizeWith",this)||(t=mt(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(v(t,"requireFailure",this))return this;var e=this.requireFail;return-1===z(e,t=mt(t,this))&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(v(t,"dropRequireFailure",this))return this;t=mt(t,this);var e=z(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,n=this.state;function i(n){e.manager.emit(n,t)}n<8&&i(e.options.event+bt(n)),i(e.options.event),t.additionalEvent&&i(t.additionalEvent),n>=8&&i(e.options.event+bt(n))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=32},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(33&this.requireFail[t].state))return!1;t++}return!0},recognize:function(t){var e=c({},t);if(!j(this.options.enable,[this,e]))return this.reset(),void(this.state=32);56&this.state&&(this.state=1),this.state=this.process(e),30&this.state&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},O(yt,vt,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,i=6&e,r=this.attrTest(t);return i&&(8&n||!r)?16|e:i||r?4&n?8|e:2&e?4|e:2:32}}),O(Ot,yt,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var t=this.options.direction,e=[];return 6&t&&e.push("pan-y"),24&t&&e.push("pan-x"),e},directionTest:function(t){var e=this.options,n=!0,i=t.distance,r=t.direction,o=t.deltaX,a=t.deltaY;return r&e.direction||(6&e.direction?(r=0===o?1:o<0?2:4,n=o!=this.pX,i=Math.abs(t.deltaX)):(r=0===a?1:a<0?8:16,n=a!=this.pY,i=Math.abs(t.deltaY))),t.direction=r,n&&i>e.threshold&&r&e.direction},attrTest:function(t){return yt.prototype.attrTest.call(this,t)&&(2&this.state||!(2&this.state)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=gt(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),O(Mt,yt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||2&this.state)},emit:function(t){1!==t.scale&&(t.additionalEvent=this.options.event+(t.scale<1?"in":"out")),this._super.emit.call(this,t)}}),O(jt,vt,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return["auto"]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,r=t.deltaTime>e.time;if(this._input=t,!i||!n||12&t.eventType&&!r)this.reset();else if(1&t.eventType)this.reset(),this._timer=d((function(){this.state=8,this.tryEmit()}),e.time,this);else if(4&t.eventType)return 8;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){8===this.state&&(t&&4&t.eventType?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=f(),this.manager.emit(this.options.event,this._input)))}}),O(Tt,yt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return["none"]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||2&this.state)}}),O(xt,yt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return Ot.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return 30&n?e=t.overallVelocity:6&n?e=t.overallVelocityX:24&n&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&p(e)>this.options.velocity&&4&t.eventType},emit:function(t){var e=gt(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),O(Dt,vt,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return["manipulation"]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,i=t.distance<e.threshold,r=t.deltaTime<e.time;if(this.reset(),1&t.eventType&&0===this.count)return this.failTimeout();if(i&&r&&n){if(4!=t.eventType)return this.failTimeout();var o=!this.pTime||t.timeStamp-this.pTime<e.interval,a=!this.pCenter||Y(this.pCenter,t.center)<e.posThreshold;if(this.pTime=t.timeStamp,this.pCenter=t.center,a&&o?this.count+=1:this.count=1,this._input=t,0==this.count%e.taps)return this.hasRequireFailures()?(this._timer=d((function(){this.state=8,this.tryEmit()}),e.interval,this),2):8}return 32},failTimeout:function(){return this._timer=d((function(){this.state=32}),this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Ct.VERSION="2.0.7",Ct.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[Tt,{enable:!1}],[Mt,{enable:!1},["rotate"]],[xt,{direction:6}],[Ot,{direction:6},["swipe"]],[Dt],[Dt,{event:"doubletap",taps:2},["tap"]],[jt]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},Pt.prototype={set:function(t){return c(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){var n;this.touchAction.preventDefaults(t);var i=this.recognizers,r=e.curRecognizer;(!r||r&&8&r.state)&&(r=e.curRecognizer=null);for(var o=0;o<i.length;)n=i[o],2===e.stopped||r&&n!=r&&!n.canRecognizeWith(r)?n.reset():n.recognize(t),!r&&14&n.state&&(r=e.curRecognizer=n),o++}},get:function(t){if(t instanceof vt)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(v(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(v(t,"remove",this))return this;if(t=this.get(t)){var e=this.recognizers,n=z(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(void 0!==t&&void 0!==e){var n=this.handlers;return b(I(t),(function(t){n[t]=n[t]||[],n[t].push(e)})),this}},off:function(t,e){if(void 0!==t){var n=this.handlers;return b(I(t),(function(t){e?n[t]&&n[t].splice(z(n[t],e),1):delete n[t]})),this}},emit:function(t,e){this.options.domEvents&&function(t,e){var n=o.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e,e.target.dispatchEvent(n)}(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var i=0;i<n.length;)n[i](e),i++}},destroy:function(){this.element&&It(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},c(Ct,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:32,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:24,DIRECTION_ALL:30,Manager:Pt,Input:L,TouchAction:dt,TouchInput:ot,MouseInput:B,PointerEventInput:tt,TouchMouseInput:st,SingleTouchInput:nt,Recognizer:vt,AttrRecognizer:yt,Tap:Dt,Pan:Ot,Swipe:xt,Pinch:Mt,Rotate:Tt,Press:jt,on:x,off:D,each:b,merge:y,extend:m,assign:c,inherit:O,bindFn:M,prefixed:w}),(void 0!==r?r:"undefined"!=typeof self?self:{}).Hammer=Ct,void 0===(i=(function(){return Ct}).call(e,n,e,t))||(t.exports=i)}(window,document)}}]);